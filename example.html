<script type="module">
    import { KittoForm } from 'https://esm.run/kitto-form@0.0.4';

    const form = new KittoForm("#signup-form");
    form.field("register_for_text")
        .watch((value) =>
        {
            if (value.startsWith("Myself"))
            {
                form.field("children_count").set(0);
                form.slot("parent-details-section").show(["@parent-details", "@preferred-details"]);
            } else
            {
                form.slot("parent-details-section").hide();
            }
            if (value.includes("Child"))
            {
                form.field("children_count").set(1);
                form.element("#quantity-selector").show();
            } else
            {
                form.field("children_count").set(0);
                form.element("#quantity-selector").hide();
            }
        });

    form.field("register_for_text")
        .watch((value) =>
        {
            if (value.startsWith("Myself"))
            {
                form.field("children_count").set(0);
                form.slot("parent-details-section").show(["@parent-details", "@preferred-details"]);
            } else
            {
                form.slot("parent-details-section").hide();
            }
            if (value.includes("Child"))
            {
                form.field("children_count").set(1);
                form.element("#quantity-selector").show();
            } else
            {
                form.field("children_count").set(0);
                form.element("#quantity-selector").hide();
            }
        });

    form.field("children_count")
        .transform((value) => Number(value))
        .if((value) => value > 0)
        .repeat()
        .render({
            name: "child-$n",
            show: ["@child-details", "@preferred-details"],
            slot: "child-details-section",
        });

    const registerFor = document.querySelector('[name="register_for_text"]')
    document.querySelectorAll('[name="register-for"]')
        .forEach(radio =>
        {
            radio.addEventListener('change', e =>
            {
                console.log("Changed!!!", e.target.checked)
                if (e.target.checked)
                {
                    const value = e.target.value;
                    const valueSetter = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value').set;
                    valueSetter.call(registerFor, value);
                    registerFor.dispatchEvent(new Event('input', { bubbles: true }));
                    registerFor.dispatchEvent(new Event('change', { bubbles: true }));
                }
            });
        });
</script>import {KittoForm} from 'https://esm.run/kitto-form@0.0.4';

const form = new KittoForm("#signup-form");

form.field("register_for_text")
.if( (value) => value.startsWith("Myself"))
.render({
name: "parent",
show: ["@parent-details", "@preferred-details"],
slot: "parent-details-section",
});

form.field("register_for_text")
.if( (value) => value.includes("Child"))
.render({
name: "",
show: ["#quantity-selector"],
});

form.field("children_count")
.transform( (value) => Number(value))
.if( (value) => value > 0)
.repeat()
.render({
name: "child-$n",
show: ["@child-details", "@preferred-details"],
slot: "child-details-section",
});

const childrenCount = document.querySelector('[name="children_count"')
const registerFor = document.querySelector('[name="register_for_text"]')
document.querySelectorAll('[name="register-for"]')
.forEach(radio => {
radio.addEventListener('change', e => {
if (e.target.checked) {
const value = e.target.value;
const valueSetter = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value').set;
valueSetter.call(registerFor, value);
registerFor.dispatchEvent(new Event('input', { bubbles: true }));
registerFor.dispatchEvent(new Event('change', { bubbles: true }));
}
});
});
registerFor.onChange = (e) => {
if (e.target.value.startsWith("Myself")) {
childrenCount.value = 0
}